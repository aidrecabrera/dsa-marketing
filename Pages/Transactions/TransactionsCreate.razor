@page "/TransactionsCreate"
@using Aneta.Models
@using Aneta.Data

@code {
    private bool isInitialized = false;
    [Inject]
    private DsaClusterContext? Context { get; set; }
    [Inject]
    private UnitOfWork? UnitOfWork { get; set; }

    private Transaction _transaction;
    private TransactionDocument _transactionDocument;
    private TransactionItem _transactionItem;

    protected override async Task OnInitializedAsync()
    {
        if (isInitialized)
            return;

        isInitialized = true;

        if (UnitOfWork == null || Context == null)
            return;

        try
        {
            _transaction = new Transaction
            {
                MunicipalityName = "Digos City",
                BarangayName = "Zone 3",
            };

            _transactionDocument = new TransactionDocument
            {
                PunongBarangayName = "Aidre Cabrera",
                BarangayTreasurerName = "Trisha Talagtag"
            };

            _transactionItem = new TransactionItem
            {
                Amount = 500,
                Cost = 58,
                Particulars = "Jasmine Rice",
                Price = 58,
                Quantity = 55,
                UnitName = "KG"
            };

            _transaction.TransactionDocuments.Add(_transactionDocument);
            _transactionDocument.Transaction = _transaction;
            _transactionDocument.TransactionItems.Add(_transactionItem);
            _transactionItem.Document = _transactionDocument;

            UnitOfWork = new UnitOfWork(Context);
            UnitOfWork.Transaction.Add(_transaction);

            await UnitOfWork.CompleteAsync();
        }
        catch (Exception ex)
        {
            // Handle exceptions as needed
        }
        finally
        {
            if (UnitOfWork != null)
            {
                using (UnitOfWork)
                {
                    // No need to call Dispose() explicitly
                }
            }
        }
    }
}
